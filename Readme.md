![1711550963228.png](https://global.cdn.mikupics.cn/2024/03/27/660431f51e9ab.png)

# NyaaWorks 家具系统

当前版本 alpha v0.1.1 - Minecraft 24w13a

## 功能简介

- 为原版游戏提供了带有丰富功能和简单互动的自定义家具
- 配合资源包可以实现家具的不同材质
- 丰富的游戏内自定义功能，可在游戏内方便的创建和调试新的家具

## 家具创建

- 取一个潜影盒，在盒内按照特定的规则摆放不同物品。规则详见下方介绍
- 将摆好物品的盒子拿在手中，输入指令`/function nw:add_fur`，即可得到一个灵魂篝火作为新的家具。

## 摆放、使用和移除

- 放置通过创建得到的灵魂篝火即可将家具摆放
    - 家具朝向与玩家朝向相同
    - 在水上和水下均可放置
    - 注意：如果在视角快速晃动时放置，会导致家具散架而损坏
- 右键点击摆出的家具可以与家具互动
    - 自定义的互动效果详见下方介绍
- 左键点击家具可以将其拆下收回

## 创建规则

每个家具拥有两个不同的状态——状态A、状态B。在每个状态下，家具有着独立的属性和效果，包括：

- 模型外观
- 玩家交互的效果
- 自动播放的效果

在家具被摆放时，默认处于状态A。

使用潜影盒定义时，每个潜影盒按下图分为七个区域：

![1711550839303.png](https://global.cdn.mikupics.cn/2024/03/27/66043179b89a7.png)

- 红色（a1-a3）：基本属性
- 深绿色（b1-b3）：状态A属性
- 浅绿色（c1-c6）：状态A的玩家交互效果
- 黄色（d1-d3）：状态A的自动播放效果
- 深蓝色（e1-e3）：状态B属性
- 蓝色（f1-f6）：状态B的玩家交互效果
- 天蓝色（g1-g3）：状态B的自动播放效果

对于红色（a1-a3）、深绿色（b1-b3）和深蓝色（e1-e3）的部分，每一格具有明确的作用：

- a1：这格物品的如下组件（component）会被物品形式的家具所继承：
    - "minecraft:custom_name" 物品的名称
    - "minecraft:custom_model_data" 物品的自定义模型编号
    - "minecraft:lore" 物品的铭文
    - "minecraft:unbreakable" 物品是否不可破坏（未来应用于家具）
- a2：决定状态A自动播放效果的间隔。在这格摆放时钟（clock）时，堆叠的数量为间隔秒数；在这格摆放钟（bell）时，堆叠的数量*10为间隔秒数
    - 如果未放置物品，默认的自动播放间隔为1秒
- a3：决定状态A自动播放效果的间隔，规则同a2
- b1：这格物品决定状态A下，家具摆出后展示出的外观，包括物品的id与自定义模型编号（custom_model_data）
    - 如果这格为空，则沿用a1格的物品的id与自定义模型编号
- b2：这格物品决定状态A下，家具摆出后，内部填充的原版方块
    - 可以使用屏障（barrier）来为家具提供碰撞模型
    - 可以使用光（light）来制作照明类家具
    - 不建议使用任何在生存下可以被破坏或推动的方块作为内部填充，以避免方块复制的问题
- b3：这格物品决定状态A的一些特殊属性
    - 在这格堆叠3个物品时，会将状态A定义为"桌子类方块"。此时，其内部填充方块的上表面会露出来，使得其他方块或者家具可以摆放在该家具的上方。建议配合在b2放置屏障使用。
- e1：决定状态B的外观，规则同b1
    - 特别的，如果这格为空，会优先沿用b1格物品的id与自定义模型编号。如果b1格也为空，再沿用a1格
- e2：决定状态B的内部填充方块，规则同b2
- e3：决定状态B的特殊属性，规则同b3

在浅绿色（c1-c6）放置物品，能够使玩家在状态A交互时产生一系列的交互效果。其中，每一格都能够定义一个独立的效果，所有定义的效果按顺序执行。放置的物品与所定义的效果对应关系如下：

- **荧光墨囊（glow_ink_sac）- 在家具处播放粒子**
    - 粒子种类由荧光墨囊的物品组件（component）中的字段`"minecraft:custom_data".particletype`所定义
    - 例如使用指令`/give @s glow_ink_sac[minecraft:custom_data:{particletype:"firework"}]`获取的荧光墨囊，将定义烟花粒子效果
    - 部分复杂的粒子效果（如dust）无法通过此种方式定义
    - 特别的，将墨囊的`"minecraft:custom_data".isprecise`字段定义为`1`时，能够仅在家具上方播放一个粒子
- **音符盒(note_block) - 在家具处播放声音**
    - 声音类型由音符盒的物品组件中的字段`"minecraft:custom_data".soundtype`所定义
    - 例如使用指令`/give @s note_block[minecraft:custom_data:{soundtype:"entity.player.levelup"}]`获取的音符盒，将定义玩家升级的声音
- **橡木木牌(oak_sign) - 向交互的玩家显示聊天框文字**
    - 木牌的名字将定义聊天框文字内容
- **药水（potion）- 赋予交互的玩家药水效果**
    - 需要使用自定义药水效果，而非原版自带的药水效果
    - 例如使用指令`/give @s potion[minecraft:potion_contents={custom_effects:[{id:"minecraft:slowness",amplifier:1b,duration:200}]}]`获得的药水，将定义持续10秒的缓慢II效果
- **箭（arrow）- 对交互的玩家造成伤害**
    - 堆叠的数量定义造成的伤害值
- **收纳袋（bundle）- 在家具处生成物品**
    - 收纳袋中的物品定义生成的内容，包括堆叠数
    - 如果一个收纳袋放入了多种物品，则在所有的种类中随机
- **仙人掌（cactus）- 删除交互的玩家手中物品**
- **指南针（compass）- 传送交互的玩家**
    - 需要事先使用指南针点击磁石，记录传送的目的地坐标。
    - 需要在完成家具创建后再拆除磁石
    - 需要使用时，建议将该效果放置在列表的最后，以防后续效果因距离家具过远而无法触发
- **命令方块（command_block）- 执行其中的指令**
    - 在命令方块中输入指令后，使用ctrl+中间复制，将指令存储在其中
    - 命令的执行者为交互的玩家，执行位置为家具位置
- **橡木台阶（oak_slab）- 坐在家具的半高位置**
- **橡木木板（oak_plank）- 坐在家具的全高位置**
- **时钟（clock）- 添加交互冷却时间**
    - 堆叠的数量为添加的冷却秒数
    - 冷却时间将在本次交互完成后添加到下次交互前
- **钟（bell）- 添加交互冷却时间**
    - 与时钟相同，但每个钟将会添加 10 秒时间
- **橡木按钮（oak_button）- 切换家具状态**
    - 在交互后，切换家具为另一个状态

同理，在蓝色（f1-f6）放置上述物品，能够使玩家在状态B交互时产生一系列的交互效果。而在黄色（d1-d3）与天蓝色（g1-g3）放置上述物品时，能够分别定义家具在状态A和状态B下自动播放的效果。需要注意，部分效果对于自动播放无效，且部分效果的生效对象有别。有效的效果列表为：

- 荧光墨囊（glow_ink_sac）- 在家具处播放粒子
- 音符盒(note_block) - 在家具处播放声音
- 橡木木牌(oak_sign) - 向**附近的随机一位玩家**显示聊天框文字
- 药水（potion）- 赋予**附近的随机一位玩家**药水效果
- 箭（arrow）- 对**附近的随机一位玩家**造成伤害
- 收纳袋（bundle）- 在家具处生成物品
- 命令方块（command_block）- 执行其中的指令
    - 命令的执行者为家具的交互实体，执行位置为家具位置
- 橡木按钮（oak_button）- 切换家具状态